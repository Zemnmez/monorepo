---
layout: article
---

import style from './list.module.sass';

# An Uncomfortable Truth About HTML Lists

Considering that HTML was concieved as a way to write text documents, you might be forgiven for thinking that it had good coverage of a lot of text document features. You might be. I'd forgive you, because I thought the same.

The articles on this website are written in Markdown, a now famous and ubiquitous light converts-to-html format.

To produce a list like this:

1. Apples
2. Oranges
3. Pears

I simply type:

```markdown
1. Apples
2. Oranges
3. Pears
```

The astute among you might already know that the original markdown specification actually specified no way to make nested lists. Writing something like:

```markdown
1. Apples
    2. Braeburn Apples
2. Oranges
```

Would simply produce:

1. Apples 2. Braeburn Apples
2. Oranges

That's fine, we (people in the future) already fixed that one.

You may know, too that HTML has very lackluster support for nested lists, for example:

<ol>
    <li> Apples </li>
    <ol>
        <li>Braeburn Apples</li>
    </ol>
    <li>Oranges</li>
</ol>

Here, depending on your browser, you proably get a list where the inner list is numbered '1.', '2.', '3.', *but so is the inner list* making it hard to address individual items. Which, as far as I'm concerned is one of the main benefits of ordered nested lists.

Not to worry, CSS introduced CSS counters:

```html
<style type="text/css">
ol.modernList, ol.modernList ol {
    counter-reset: list
}

ol.modernList li {
    counter-increment: list
    list-style: none
}

ol.modernList li::before {
    content: counters(list, ".")
}
</style>
<ol className="modernList">
    <li> Apples </li>
    <ol>
        <li>Braeburn Apples</li>
    </ol>
    <li>Oranges</li>
</ol>
```

<ol className={style.modernList}>
    <li> Apples
        <ol>
            <li>Braeburn Apples</li>
        </ol>
    </li>
    <li>Oranges</li>
</ol>

This seems fine at first, but there's a problem, which appears only on long lists of more than 10 items, or if you're using a font where the numbers are differently sized:


<ol className={style.modernList}>
    <li> Apples
        <ol>
            <li>Braeburn Apples</li>
            <li>Bramley Apples</li>
            <li>Cox Apples</li>
            <li>Crab Apples</li>
            <li>Wolf River Apple</li>
            <li>...</li>
            <li style={{counterIncrement: "list 10"}}>Brina Apple</li>
            <li>Beauty of Bath Apple</li>
        </ol>
    </li>
    <li>Oranges</li>
</ol>

That's right. The numerals and content aren't aligned. This is internally because list items are not put in a table layout. Instead, they're just padded in from the left for each indent level.

## Trying to Fix it

That's OK though, because it's 2020 and css is getting _sweet_. We can use CSS Grid to automatically define a table. I'm just going to switch to using SASS syntax here for convenience.

What this CSS does is create a grid that has cells for each indent level's numeral, and then each item just spans all the rest of the cells.

```sass
.grid1
    ol, li ul
        padding: 0
        margin: 0
    
ol.grid1, ol.grid1 ol
    counter-reset: list
    display: grid
    grid-template-columns: repeat(5, 2rem) 1fr
    list-style: none
        
    li
        counter-increment: list
        grid-column: 2 / -1
        width: 100%
        &::before
        grid-column: 1
        content: counters(list, ".")
        
    ol > li
        grid-column: 3 / -1
        opacity: .8
        &::before
        grid-column: 2
        
    ol > ol > li
        grid-column: 4 / -1
        opacity: .7
        &::before
        grid-column: 3


```

<ol className={style.grid1}>
    <li> Apples
        <ol>
            <li>Braeburn Apples</li>
            <li>Bramley Apples</li>
            <li>Cox Apples</li>
            <li>Crab Apples</li>
            <li>Wolf River Apple</li>
            <li>...</li>
            <li style={{counterIncrement: "list 10"}}>Brina Apple</li>
            <li>Beauty of Bath Apple</li>
        </ol>
    </li>
    <li>Oranges</li>
</ol>


Wait, what the fuck? Did I grid wrong? Yes. Thing is, when you make a CSS grid, the items that can be placed in the cell are *only* its direct children in the element tree. So the nested `ol` has been *auto-placed* on the grid, and thus hasn't inherited the `grid-column` attribute that causes it to properly span the grid.

[CSS Subgrid] is meant to solve this problem, but is sadly only implemented in Firefox. No mind. There is a not *terribly* well supported attribute called `display: contents` which lets us make elements act as though they're part of the parent element.

[CSS Subgrid]: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout/Subgrid

```sass
.grid2
    ol, li ul
        padding: 0
        margin: 0
    
ol.grid2, ol.grid2 ol
    counter-reset: list
    display: grid
    grid-template-columns: repeat(5, 2rem) 1fr
    list-style: none

    ol
        display: block
  
    ol, ul
        display: contents
        width: initial
        
    li
        counter-increment: list
        grid-column: 2 / -1
        width: 100%
        &::before
        grid-column: 1
        content: counters(list, ".")
        
    ol > li
        grid-column: 3 / -1
        opacity: .8
        &::before
        grid-column: 2
        
    ol > ol > li
        grid-column: 4 / -1
        opacity: .7
        &::before
        grid-column: 3
```
<ol className={style.grid2}>
    <li> Apples
        <ol>
            <li>Braeburn Apples</li>
            <li>Bramley Apples</li>
            <li>Cox Apples</li>
            <li>Crab Apples</li>
            <li>Wolf River Apple</li>
            <li>...</li>
            <li style={{counterIncrement: "list 10"}}>Brina Apple</li>
            <li>Beauty of Bath Apple</li>
        </ol>
    </li>
    <li>Oranges</li>
</ol>

Okay, what's happened here? Well, it's to do with there not being a *normal* way to make nested lists. For CSS counters to work, sub-lists have to be *children* of their parent `<li>` list element, which means it's not as simple as saying `<ol>` elements always expand to their children; we actually have to detect *which* `<li>` elements have `<ol>` children and apply `display: contents` to those. Problem is, there's no CSS selector for this. No mind. I can manually annotate which elements should be expanded.

```html
<ol class="grid3">
    <li class="expand"> Apples
        <ol class="expand">
            <li>Braeburn Apples</li>
            <li>Bramley Apples</li>
            <li>Cox Apples</li>
            <li>Crab Apples</li>
            <li>Wolf River Apple</li>
            <li>...</li>
            <li style="counter-increment: list 10">Brina Apple</li>
            <li>Beauty of Bath Apple</li>
        </ol>
    </li>
    <li>Oranges</li>
</ol>
```
<ol className={style.grid3}>
    <li className={style.expand}> Apples
        <ol className={style.expand}>
            <li>Braeburn Apples</li>
            <li>Bramley Apples</li>
            <li>Cox Apples</li>
            <li>Crab Apples</li>
            <li>Wolf River Apple</li>
            <li>...</li>
            <li style={{counterIncrement: "list 10"}}>Brina Apple</li>
            <li>Beauty of Bath Apple</li>
        </ol>
    </li>
    <li>Oranges</li>
</ol>

That's uh... a slight improvement? Perhaps? Now, because the `<li>`'s children are treated as though they're parented to the `<ol>`, the numbers are counting up, regardless of the list level :(

Time to take the controls ourselves. Let's give every list item a `data-depth`, which indicates that it should *not* be expanded, and instead treated as an item -- and we can use the `data-depth` to determine what cell the item gets placed in. We'll also need a `data-label` since we can't rely on CSS to give us a proper label anymore, and we'll need to wrap `Apples` in a `<span>`, so that it can be given a grid cell.

```sass
.grid2
    ol, li ul
        padding: 0
        margin: 0
    
ol.grid2, ol.grid2 ol
    counter-reset: list
    display: grid
    grid-template-columns: repeat(5, 2rem) 1fr
    list-style: none

    ol
        display: block
  
    ol, ul
        display: contents
        width: initial
        
    li
        counter-increment: list
        grid-column: 2 / -1
        width: 100%
        &::before
        grid-column: 1
        content: counters(list, ".")
        
    ol > li
        grid-column: 3 / -1
        opacity: .8
        &::before
        grid-column: 2
        
    ol > ol > li
        grid-column: 4 / -1
        opacity: .7
        &::before
        grid-column: 3
```

```html
<ol className="grid4">
    <li>
        <span data-depth="1" data-label="1.">Apples</span>
        <ol>
            <li data-depth="2" data-label="1.1.">Braeburn Apples</li>
            <li data-depth="2" data-label="1.2.">Bramley Apples</li>
            <li data-depth="2" data-label="1.3.">Cox Apples</li>
            <li data-depth="2" data-label="1.4.">Crab Apples</li>
            <li data-depth="2" data-label="1.5.">Wolf River Apple</li>
            <li data-depth="2" data-label="1.6.">...</li>
            <li data-depth="2" data-label="1.2.4.5.reallylonglabel.">Brina Apple</li>
            <li data-depth="2" data-label="1.8.">Beauty of Bath Apple</li>
        </ol>
    </li>
    <li data-depth="1" data-label="2.">Oranges</li>
</ol>
```

<ol className={style.grid4}>
    <li>
        <span data-depth="1" data-label="1.">Apples</span>
        <ol>
            <li data-depth="2" data-label="1.1.">Braeburn Apples</li>
            <li data-depth="2" data-label="1.2.">Bramley Apples</li>
            <li data-depth="2" data-label="1.3.">Cox Apples</li>
            <li data-depth="2" data-label="1.4.">Crab Apples</li>
            <li data-depth="2" data-label="1.5.">Wolf River Apple</li>
            <li data-depth="2" data-label="1.6.">...</li>
            <li data-depth="2" data-label="1.2.4.5.reallylonglabel.">Brina Apple</li>
            <li data-depth="2" data-label="1.8.">Beauty of Bath Apple</li>
        </ol>
    </li>
    <li data-depth="1" data-label="2.">Oranges</li>
</ol>

Ugh... the `::before` is parented to the `<li>`, and there's no way to separate it from the the text because you [can't select text nodes][::text]...

[::text]: https://github.com/w3c/csswg-drafts/issues/2208


## Last Resort?

Let's reassess what we really want out of this, and what we can actually do:

- Lists that *are* just regular list elements so they work with screen-readers
- ~~Lists that don't require additional markup to work~~
- With correctly aligned labels

ARIA should handle the list just normally, so if we introduce our own elements just for the labels, we can just use `aria-hidden="true"` to prevent screen readers double-reading the list elements. This is going to be fucked up, but let's try it.

<ol className={style.grid5}>
    <li>
        <span data-depth="1">
            <span className={style.index} aria-hidden="true">1.</span>
            <span className={style.item}>Apples</span>
        </span>
        <ol>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.1.</span>
                <span className={style.item}>Braeburn Apples</span>
            </li>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.2.</span>
                <span className={style.item}>Bramley Apples</span>
            </li>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.3.</span>
                <span className={style.item}>Cox Apples</span>
            </li>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.4.</span>
                <span className={style.item}>Crab Apples</span>
            </li>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.5.</span>
                <span className={style.item}>Wolf River Apple</span>
            </li>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.6.</span>
                <span className={style.item}>...</span>
            </li>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.7.11</span>
                <span className={style.item}>Brina Apple</span>
            </li>
            <li data-depth="2">
                <span className={style.index} aria-hidden="true">1.8.</span>
                <span className={style.item}>Beauty of Bath Apple</span>
            </li>
        </ol>
    </li>
    <li data-depth="1">
        <span className={style.index} aria-hidden="true">2.</span>
        <span className={style.item}>Oranges</span>
    </li>
</ol>

That's good, but I just checked and ARIA no longer handles the list normally... Guess i'm giving up.